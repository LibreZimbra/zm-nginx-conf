user zimbra zimbra;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

pid        /opt/zimbra/log/nginx.pid;
error_log  /opt/zimbra/log/nginx.log info;


events {
    worker_connections  1024;
}

mail {

#   Memcache configuration
    memcache_servers localhost:11211;

#   The time to live (TTL) for an entry added to the memcached server
#   This value represents the amount of time that the route information
#   that is cached into the memcached servers will be available, before
#   the memcached daemon expires it
#   Memcached expects the TTL for an entry to be specified in seconds,
#   therefore any value specified in milliseconds here will be rounded
#   up to the next integer value in seconds. If not specified, the TTL
#   defaults to 0, which indicates an infinite time to live for the
#   routing information
#    memcache_entry_ttl             3600s;

#   Pass error messages
#    proxy_pass_error_message on;

#   http authentication configuration
    auth_http localhost:7072/service/extension/nginx-lookup;

	pop3_capabilities        "TOP" "USER" "UIDL" "STLS" "EXPIRE 31 USER";
	imap_capabilities        "IMAP4rev1" "STARTTLS" "BINARY" "CHILDREN" "ID" "LITERAL+" "LOGIN-REFERRALS" "NAMESPACE" "QUOTA" "SASL-IR" "UIDPLUS" "UNSELECT";

#   TLS configuration
    starttls on;
    ssl_prefer_server_ciphers on;
    ssl_certificate             /opt/zimbra/conf/nginx.crt;
    ssl_certificate_key         /opt/zimbra/conf/nginx.key;

    server {
        listen %%zimbraPop3ProxyBindPort%%;
        protocol pop3;
        proxy on;
    }

    server {
        listen %%zimbraPop3SSLProxyBindPort%%;
        protocol pop3;
        proxy on;
		ssl on;
    }

#   IMAP proxy config
    server {
        listen %%zimbraImapProxyBindPort%%;
        protocol imap;
        proxy on;
    }

    server {
        listen %%zimbraImapSSLProxyBindPort%%;
        protocol imap;
        proxy on;
		ssl on;
    }
}
